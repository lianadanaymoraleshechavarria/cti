{% extends "base.html" %}
{% load static %}

<!-- Conatiner CSS -->
{% block css %}
<link rel="stylesheet" href="{% static 'css/Dashboard.css' %}">
<link rel="stylesheet" href="{% static 'css/datatableSD.css' %}">
{% endblock %}
<!-- End Conatiner CSS -->

{% block content %}
<div class="main">
  <main class="content-inside px-3 py-2">
    <div class="container-fluid">
      <div class="container-fluid">
        <div class="row d-flex justify-content-center">
          <div class="col-lg-3 col-6">
            <div class="small-box bg-box-one">
              <div class="inner">
                <h3>{{total_articulos }}</h3>
                <p>Total de Publicaciones</p>
              </div>
              <div class="icon">
                <i class=" bx bx-file"></i>
              </div>
              <a href="{% url 'Articulo_List' %}" class="small-box-footer">Más información <i
                  class="bi bi-arrow-right-circle"></i></a>
            </div>
          </div>
          <div class="col-lg-3 col-6">
            <div class="small-box bg-box-one">
              <div class="inner">
                <h3>{{total_premios }}</h3>
                <p>Total de Premios</p>
              </div>
              <div class="icon">
                <i class="bx bx-bar-chart"></i>
              </div>
              <a href="{% url 'Premio_List' %}" class="small-box-footer">Más información <i
                  class="bi bi-arrow-right-circle"></i></a>
            </div>
          </div>
          <div class="col-lg-3 col-6">
            <div class="small-box bg-box-one">
              <div class="inner">
                <h3>{{total_proyectos}}</h3>
                <p>Total de Proyectos</p>
              </div>
              <div class="icon">
                <i class="bx bx-user-plus"></i>
              </div>
              <a href="{% url 'Proyecto_List' %}" class="small-box-footer">Más información <i
                  class="bi bi-arrow-right-circle"></i></a>
            </div>
          </div>
          <div class="col-lg-3 col-6">
            <div class="small-box bg-box-one">
              <div class="inner">
                <h3>{{total_eventos }}</h3>
                <p>Total de Eventos</p>
              </div>
              <div class="icon">
                <i class="bx bxs-pie-chart-alt-2"></i>
              </div>
              <a href="{% url 'Evento_List' %}" class="small-box-footer">Más información <i
                  class="bi bi-arrow-right-circle"></i></a>
            </div>
          </div>
        </div>
        <section>
          <div class="row mt-4">
            <div class="col-lg-5 mb-lg-0 mb-4  overflow-hidden">
              <div id="graficaAnualContainer" style="height: 400px; padding-top:40px;"></div>
            </div>
            <div class="col-lg-7 col-sm-12">
              <div class="card card-carousel overflow-hidden p-0">
                <div id="carouselExampleCaptions" class="carousel slide " data-bs-ride="carousel">
                  <div class="carousel-inner border-radius-lg">
                    <div class="carousel-item">
                      <img src="{% static 'img/Uho 1.jpg' %}" class="d-block w-100 " alt="...">
                      <div class="carousel-caption d-none d-md-block bottom-0 text-start start-0 ms-5">
                        <h5 class="text-white mb-1">
                          "La educación es el arma más poderosa que puedes usar para cambiar el mundo."<br>Nelson
                          Mandela</h5>
                      </div>
                    </div>
                    <div class="carousel-item">
                      <img src="{% static 'img/Uho 2.jpg' %}" class="d-block w-100 " alt="...">
                      <div class="carousel-caption d-none d-md-block bottom-0 text-start start-0 ms-5">
                        <h5 class="text-white mb-1">UHo</h5>
                        <p>Espacio para Crecer</p>
                      </div>
                    </div>
                    <div class="carousel-item active">
                      <img src="{% static 'img/Uho 3.jpg' %}" class="d-block w-100 " alt="...">
                      <div class="carousel-caption d-none d-md-block bottom-0 text-start start-0 ms-5">
                        <h4 class="text-white mb-1"></h4>
                        <h5>Universidad de Holguín</h5>
                      </div>
                    </div>
                  </div>
                  <button class="carousel-control-prev w-5 me-3" type="button" data-bs-target="#carouselExampleCaptions"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                  </button>
                  <button class="carousel-control-next w-5 me-3" type="button" data-bs-target="#carouselExampleCaptions"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section>
          <div class="container-fluid">
            <main class="main-content">
              <div class="row">
                <!-- Gráfica de Aprobación -->
                <section class="col-md-6 col-sm-12 mb-3">
                    <div class="card-body">
                      <div id="aprobacion"></div>
                    </div>
                </section>

                <!-- Gráfica de Distribución -->
                <section class="col-md-6 col-sm-12 mb-3">
                    <div class="card-body">
                      <div id="marcadores"></div>
                    </div>
                </section>


              </div>
            </main>
          </div>
        </section>
      </div>
    </div>
  </main>
</div>
{% endblock %}

{% block js %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{% static 'libs/Highcharts/code/highcharts.js' %}"></script>
<script src="{% static 'libs/Highcharts/code/modules/accessibility.js' %}"></script>
<script src="{% static 'libs/Highcharts/code/modules/exporting.js' %}"></script>
<script src="{% static 'libs/Highcharts/code/modules/offline-exporting.js' %}"></script>
<script src="{% static 'libs/Highcharts/code/modules/export-data.js' %}"></script>

<script>
        $(document).ready(function() {
          // Configuración común para todas las gráficas
          Highcharts.setOptions({
            lang: {
              thousandsSep: ','
            },
            credits: {
              enabled: false
            }
          });
        
          // Gráfica de Estados (Aprobación)
          if (typeof {{ data_grafica_estados|safe }} !== 'undefined') {
            Highcharts.chart('aprobacion', {
              chart: {
                type: 'column',
                height: '400px'
              },
              title: {
                text: 'Totales por Estado de Aprobación'
              },
              xAxis: {
                type: 'category',
                title: {
                  text: 'Estado'
                },
                categories: {{ data_grafica_estados|safe }}.map(item => item.nombre)
              },
              yAxis: {
                title: {
                  text: 'Cantidad'
                },
                allowDecimals: false
              },
              tooltip: {
                headerFormat: '<span style="font-size:11px">{point.key}</span><br>',
                pointFormat: '<span style="color:{point.color}">●</span> {series.name}: <b>{point.y}</b><br/>'
              },
              plotOptions: {
                column: {
                  borderRadius: 5,
                  dataLabels: {
                    enabled: true,
                    format: '{point.y}'
                  }
                }
              },
              series: [{
                name: 'Total',
                colorByPoint: true,
                data: {{ data_grafica_estados|safe }}.map(item => ({
                  name: item.nombre,
                  y: item.valor
                }))
              }]
            });
          }
        
          // Gráfica de Pastel (Distribución)
          if (typeof {{ data_grafica_pie|safe }} !== 'undefined') {
            Highcharts.chart('marcadores', {
              chart: {
                type: 'pie',
                height: '400px'
              },
              title: {
                text: 'Distribución por Tipo de Producción'
              },
              tooltip: {
                pointFormat: '{series.name}: <b>{point.y} ({point.percentage:.1f}%)</b>'
              },
              plotOptions: {
                pie: {
                  allowPointSelect: true,
                  cursor: 'pointer',
                  dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b>: {point.y}',
                    distance: -30,
                    filter: {
                      property: 'percentage',
                      operator: '>',
                      value: 4
                    }
                  },
                  showInLegend: true
                }
              },
              series: [{
                name: 'Total',
                colorByPoint: true,
                data: {{ data_grafica_pie|safe }}
              }]
            });
          }
        
          // Gráfica Anual Comparativa
          if (typeof {{ data_for_chart.years|safe }} !== 'undefined') {
            Highcharts.chart('graficaAnualContainer', {
              chart: {
                type: 'column'
              },
              title: {
                text: 'Producción Científica por Año'
              },
              subtitle: {
                text: 'Comparación anual de diferentes tipos de producción'
              },
              xAxis: {
                categories: {{ data_for_chart.years|safe }},
                crosshair: true
              },
              yAxis: {
                min: 0,
                title: {
                  text: 'Cantidad'
                }
              },
              tooltip: {
                headerFormat: '<span style="font-size:10px">Año {point.key}</span><table>',
                pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                  '<td style="padding:0"><b>{point.y}</b></td></tr>',
                footerFormat: '</table>',
                shared: true,
                useHTML: true
              },
              plotOptions: {
                column: {
                  pointPadding: 0.2,
                  borderWidth: 0
                }
              },
              series: [{
                name: 'Artículos',
                data: {{ data_for_chart.articulos|safe }},
                color: '#9EFD38'
              }, {
                name: 'Eventos',
                data: {{ data_for_chart.eventos|safe }},
                color: '#65C922'
              }, {
                name: 'Programas',
                data: {{ data_for_chart.programas|safe }},
                color: '#1E5227'
              }, {
                name: 'Proyectos',
                data: {{ data_for_chart.proyectos|safe }},
                color: '#BFD730'
              }, {
                name: 'Premios',
                data: {{ data_for_chart.premios|safe }},
                color: '#CFF1CF'
              }]
            });
          }
        });
        </script>
{% endblock %}